name: Build and Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build:
    runs-on: ubuntu-22.04
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up ROS2 Humble
      uses: ros-tooling/setup-ros@v0.3
      with:
        required-ros-distributions: humble
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          ros-humble-navigation2 \
          ros-humble-nav2-bringup \
          ros-humble-slam-toolbox \
          ros-humble-ros2-control \
          ros-humble-ros2-controllers \
          ros-humble-gazebo-ros2-control \
          ros-humble-twist-mux \
          python3-colcon-common-extensions
    
    - name: Build workspace
      working-directory: ros2_ws_1
      run: |
        source /opt/ros/humble/setup.bash
        colcon build --symlink-install
    
    - name: Check build artifacts
      working-directory: ros2_ws_1
      run: |
        if [ ! -d "install" ]; then
          echo "Build failed: install directory not found"
          exit 1
        fi
        echo "Build successful!"

